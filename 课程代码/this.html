<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

    <script>

        function f1() {
            console.log(this)
        }
        function f2() {
            'use strict'
            console.log(this)
        }
        f1()
        f2()

        // window
        // undefined

        // ================================

        const foo = {
            bar: 10,
            fn: function () {
                console.log(this)
                console.log(this.bar)
            }
        }
        var fn1 = foo.fn
        fn1()

        // window
        // undefined

        // ================================

        const foo = {
            bar: 10,
            fn: function () {
                console.log(this)
                console.log(this.bar)
            }
        }
        foo.fn()

        // {bar: 10, fn: ƒ}
        // 10

        // ================================

        const student = {
            name: 'Lucas',
            fn: function () {
                return this
            }
        }
        console.log(student.fn() === student)

        // true

        // ================================

        const person = {
            name: 'Lucas',
            brother: {
                name: 'Mike',
                fn: function () {
                    return this.name
                }
            }
        }
        console.log(person.brother.fn())

        // mike

        // ================================

        const o1 = {
            text: 'o1',
            fn: function () {
                return this.text
            }
        }
        const o2 = {
            text: 'o2',
            fn: function () {
                return o1.fn()
            }
        }
        const o3 = {
            text: 'o3',
            fn: function () {
                var fn = o1.fn
                return fn()
            }
        }

        console.log(o1.fn())
        console.log(o2.fn())
        console.log(o3.fn())

        // o1
        // o1
        // undefined

        // ================================

        // 让console.log(o2.fn())输出o2
        const o1 = {
            text: 'o1',
            fn: function () {
                return this.text
            }
        }
        const o2 = {
            text: 'o2',
            fn: o1.fn
        }

        console.log(o2.fn())

        // o2

        // ================================

        const foo = {
            name: 'lucas',
            logName: function () {
                console.log(this.name)
            }
        }
        const bar = {
            name: 'mike'
        }
        console.log(foo.logName.call(bar))

        // mike


        // ================================

        function Foo() {
            this.bar = "Lucas"
        }
        const instance = new Foo()
        console.log(instance.bar)

        // new运算符相当于

        var obj = {}
        obj.__proto__ = Foo.prototype
        Foo.call(obj)

        // ================================

        function Foo() {
            this.user = "Lucas"
            const o = {}
            return o
        }
        const instance = new Foo()
        console.log(instance.user)

        // undefined

        // ================================

        function Foo() {
            this.user = "Lucas"
            return 1
        }
        const instance = new Foo()
        console.log(instance.user)

        // lucas

        // ================================

        const foo = {
            fn: function () {
                setTimeout(function () {
                    console.log(this)
                })
            }
        }
        foo.fn()

        // window

        // ================================

        const foo = {
            fn: function () {
                setTimeout(() => {
                    console.log(this)
                })
            }
        }
        foo.fn()

        // {fn: ƒ}

        // ================================

        function foo(a) {
            console.log(this.a)
        }

        const obj1 = {
            a: 1,
            foo: foo
        }

        const obj2 = {
            a: 2,
            foo: foo
        }

        obj1.foo.call(obj2)
        obj2.foo.call(obj1)

        // 2
        // 1

        // ================================

        function foo(a) {
            this.a = a
        }

        const obj1 = {}

        var bar = foo.bind(obj1)
        bar(2)
        console.log(obj1.a)

        // 2

        var baz = new bar(3)
        console.log(baz.a)

        // new 绑定的优先级比显式 bind 绑定更高，通过 new 调用时，返回的实例已经与 obj1 解绑。

        // 3

        // ================================

        function foo() {
            return a => {
                console.log(this.a)
            };
        }

        const obj1 = {
            a: 2
        }

        const obj2 = {
            a: 3
        }

        const bar = foo.call(obj1)
        console.log(bar.call(obj2))

        // 2
        // 由于 foo() 的 this 绑定到 obj1，bar（引用箭头函数）的 this 也会绑定到 obj1，箭头函数的绑定无法被修改。
        // 如果不使用箭头函数就会输出3。

        // ================================

        var a = 123
        const foo = () => a => {
            console.log(this.a)
        }

        const obj1 = {
            a: 2
        }

        const obj2 = {
            a: 3
        }

        var bar = foo.call(obj1)
        console.log(bar.call(obj2))

        // 123

        // ================================

        const a = 123
        const foo = () => a => {
            console.log(this.a)
        }

        const obj1 = {
            a: 2
        }

        const obj2 = {
            a: 3
        }

        var bar = foo.call(obj1)
        console.log(bar.call(obj2))

        // undefined
        // 使用 const 声明的变量不会挂载到 window 全局对象当中

        // ================================

        Function.prototype.bind = Function.prototype.bind || function (context) {
            var me = this;
            var args = Array.prototype.slice.call(arguments, 1);
            return function bound() {
                var innerArgs = Array.prototype.slice.call(arguments);
                var finalArgs = args.concat(innerArgs);
                return me.apply(context, finalArgs);
            }
        }

    </script>
</body>

</html>
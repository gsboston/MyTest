<style>
    #zl.root-content{
        background-color: #f6f6f6;
    }
    #zl.root-content > div{
        position: relative;
        width: 920px;
        margin: 0 auto;
        background-color: white;
    }
    #zl > .zl-content {
        padding: 20px 65px 40px 15px;
    }
    #zl .part-title{
        font-size: 18px;
        padding-left: 40px;
        padding-bottom: 20px;
        color: #59b399;
    }
    #zl .zl-content .ivu-form-item-error-tip{
        padding-top: 3px;
        font-size: 12px !important;
    }
    #zlPlan .ivu-form-item-error-tip{
        padding-top: 3px;
        font-size: 12px !important;
        margin-top: -10px;
    }
    #zl .part-content{
        padding-left: 40px;
        padding-right: 20px;
    }
    #zl .part-content *{
        font-size: 14px!important;
    }
    #zl .text-item{
        padding: 0px;
    }
    #zl .text-input{
        position: relative;
        top: -10px;
        width: 100px;
    }
    #zl .text-input input{
        border-top: none;
        border-left: none;
        border-right: none;
        text-align: center;
        height: 30px;
        font-size: 14px;
    }
    #zl .serviceList{
        background: #dfeffc;
        padding: 10px 20px;
        border: 1px solid #dddee1;
    }
    #zl .ivu-input,.ivu-select-selection{
        border-radius: 0;
    }
    #zl .last-row{
        margin-left: 40px;
        padding-top: 28px;
    }
    #zl .last-row .text-item{
        font-size: 18px;
        font-weight: bold;
    }
    #zl .text-item-symbol{
        font-size: 16px !important;
        position: relative;
        top: 1px;
        font-weight:bold;
    }
    #zl .copyright-info{
        margin-left: 20px;
    }
    #zl .copyright-info > div:first-child{
        margin-top: 10px;
    }
    #zl .form-item-height{
        margin-left: 20px;
    }
    #zl .form-item-height > div{
        width: 260px;
        margin-left: 20px;
    }
    #zl .form-item-height > label{
        font-size: 14px;
    }
    #zl .text-row{
        display: inline-flex;
    }
    #zl .zl-content .ivu-form .ivu-form-item-label {
        text-align: justify;
        text-align-last: justify;
        vertical-align: middle;
        float: left;
        color: rgb(51,51,51);
        line-height: 1;
        padding: 10px 20px 10px 0;
        box-sizing: border-box;
    }
    #zl .zl-content .ivu-form-item {
        margin-bottom: 15px;
        vertical-align: top;
        zoom: 1;
    }
    #zl .zl-content .ivu-select-arrow {
        position: absolute;
        top: 50%;
        right: 15px;
        line-height: 1;
        margin-top: -7px;
        font-size: 14px;
        color: #80848f;
        transition: all .2s ease-in-out;
    }
    #zl .zl-content .ivu-checkbox {
        display: inline-block;
        vertical-align: middle;
        white-space: nowrap;
        cursor: pointer;
        outline: 0;
        line-height: 1;
        position: relative;
        padding-right: 10px;
    }
    #zl .serviceList {
        background: white;
        padding: 0;
        border: none;
        width: 97%;
        margin-left: 3%;
    }
    #zl .serviceListItem {
        margin-right: 80px;
    }
    #zl .zl-content .ivu-radio {
        display: inline-block;
        margin-right: 12px;
        white-space: nowrap;
        outline: 0;
        position: relative;
        line-height: 1;
        vertical-align: middle;
        cursor: pointer;
    }
    #zl hr{
        margin-top: 20px;
        background-color: #e5e5e5;
        height: 1px;
        border: none;
    }
    #zl .form-input{
        width: 260px;
    }
    #zl .form-input-name{
        width: 110px;
    }
    #zl .form-input-tel{
        width: 140px;
    }
    #zl .form-input-price > input{
        font-size: 30px;
        color: #ff5a5a;
    }
    #zl .form-input-unit-price > input{
        border-top: none;
        border-left: none;
        border-right: none;
        text-align: center;
        position: relative;
        width: 100px;
        font-size: 14px !important;
        height: 20px;
        text-align: left;
    }
    #zl .form-input-subtotal > input{
        border-top: none;
        border-left: none;
        border-right: none;
        text-align: center;
        position: relative;
        width: 150px;
        font-size: 14px !important;
        height: 20px;
        text-align: left;
    }
    #zl .form-input-copyright-single-other > input{
        border-top: none;
        border-left: none;
        border-right: none;
        text-align: center;
        position: relative;
        width: 415px;
        font-size: 14px !important;
        height: 20px;
        text-align: left;
    }
    #zl .otherThings .ivu-form-item-error-tip{
        top: 25px;
        left: 90px;
    }
    #zl .serviceDetail .ivu-form-item-content{
        line-height: 0px;
    }
    #zl .copyright-list {
        width: 100%;
        height: 100px;
        background-color: #fcfcfc;
        border:1px solid #fcfcfc;
    }
    #zl .copyright-list.selected {
        border:1px solid #59b399;
    }
    #zl .copyright-close {
        width: 0;
        height: 0;
        border-top: 25px solid #e5e5e5;
        border-left: 25px solid transparent;
        float: right;
    }
    #zl .copyright-close > i {
        color: #a9a9a9;
        position: absolute;
        right: 5px;
        top: 1px;
        cursor: pointer;
        font-size: 12px !important;
    }
    #zl .copyright-button-add{
        width: 262px;
        height: 40px;
        color: white;
        border: 1px solid #59b399;
        border-radius: 5px;
    }
    #zl .copyright-button-cancel{
        width: 120px;
        height: 40px;
        background-color: white;
        border: 1px solid #59b399;
        color: #59b399;
        border-radius: 5px;
    }
    #zl .copyright-button-save{
        width: 120px;
        height: 40px;
        color: white;
        border: 1px solid #59b399;
        border-radius: 5px;
    }
    #zl .ivu-input[disabled], fieldset[disabled] .ivu-input {
        background-color: #f3f3f3;
        opacity: 1;
        cursor: not-allowed;
        color: #333;
    }
    #zl .ivu-select-disabled .ivu-select-selection {
         background-color: #f3f3f3;
         opacity: 1;
         cursor: not-allowed;
         color: #333;
     }
    #zl .autoInput .ivu-auto-complete .ivu-select-dropdown{
        max-height: 200px!important;
    }
    #zl .ivu-tooltip-inner {
        max-width: 250px;
        min-height: 34px;
        padding: 8px 12px;
        color: #fff;
        text-align: left;
        text-decoration: none;
        background-color: rgba(70,76,91,.9);
        border-radius: 4px;
        box-shadow: 0 1px 6px rgba(0,0,0,.2);
        white-space: normal;
    }
</style>
<div @click="cancelSelected" id="zl" class="root-content">
    <div class="zl-content">
        <i-form :model="mainInfo" :label-width="90" :rules="ruleForm" ref="formRef">
            <Row>
                <i-col span="12" :style="{'background':1== selectedArea ?'#f6faf9' :''}">
                    <div class="part-title">甲方基本信息</div>
                    <div class="part-content" @mousedown ="selectArea(1)">
                        <Form-item label="类型" prop="type" >
                            <div @click.stop="stopBubbling">
                                <radio-group v-model="mainInfo.cSList[0].type" @on-change="changeCsType">
                                    <Radio label="COMPANY"  :disabled="!isEditable">企业</Radio>
                                    <Radio label="PERSON"  :disabled="!isEditable">自然人</Radio>
                                </radio-group>
                            </div>
                        </Form-item>
                        <Form-item :label="mainInfo.cSList[0].type=='COMPANY'?'公司名称':'姓名'" prop="cSList[0].name" class="autoInput">
                            <Tooltip :disabled="!mainInfo.cSList[0].name" :content="mainInfo.cSList[0].name" class="tips" placement="bottom">
                                <auto-comp ref="autoName" :disabled="!isEditable" class="form-input" v-model="mainInfo.cSList[0].name"  @on-search="searchCustomerByName" @on-select="selectCustomer">
                                    <i-option v-for="item in customerList" :value="item.name" :key="item.id">{{item.name}}</i-option>
                                </auto-comp>
                            </Tooltip>
                        </Form-item>
                        <Form-item label="证件号码" prop="cSList[0].idno" class="autoInput">
                            <Tooltip :disabled="!mainInfo.cSList[0].idno" :content="mainInfo.cSList[0].idno" class="tips" placement="bottom">
                                <auto-comp :maxlength="25" ref="autoNO" :disabled="!isEditable" class="form-input" :placeholder="mainInfo.cSList[0].type=='COMPANY'?'税务登记证号/统一信用代码':'身份证号'"
                                           class="form-input" v-model="mainInfo.cSList[0].idno"  @on-search="searchCustomerByNo" @on-select="selectCustomerNo">
                                    <i-option v-for="item in customerListNo" :value="item.IDNumber" :key="item.id">{{item.IDNumber}}</i-option>
                                </auto-comp>
                            </Tooltip>
                        </Form-item>
                        <Row>
                            <i-col span="13">
                                <Form-item label="联系人" prop="cSList[0].contactName">
                                    <Tooltip :disabled="!mainInfo.cSList[0].contactName" :content="mainInfo.cSList[0].contactName" class="tips" placement="bottom">
                                        <i-input class="form-input-name" v-model="mainInfo.cSList[0].contactName" :maxlength="20" placeholder="联系人姓名" :disabled="!isEditable"></i-input>
                                    </Tooltip>
                                </Form-item>
                            </i-col>
                            <i-col span="10" offset="1">
                                <Form-item :label-width='1' prop="cSList[0].contactPhone">
                                    <Tooltip :disabled="!mainInfo.cSList[0].contactPhone" :content="mainInfo.cSList[0].contactPhone" class="tips" placement="bottom">
                                        <i-input class="form-input-tel" v-model="mainInfo.cSList[0].contactPhone" :maxlength="17" placeholder="联系电话" :disabled="!isEditable"></i-input>
                                    </Tooltip>
                                </Form-item>
                            </i-col>
                        </Row>
                        <!--<Form-item label="电子邮箱" prop="cSList[0].email">-->
                        <Form-item label="电子邮箱">
                            <Tooltip :disabled="!mainInfo.cSList[0].email" :content="mainInfo.cSList[0].email" class="tips" placement="bottom">
                                <i-input class="form-input" v-model="mainInfo.cSList[0].email" :maxlength="50" placeholder="电子邮箱" :disabled="!isEditable"></i-input>
                            </Tooltip>
                        </Form-item>
                        <Form-item label="联系地址" prop="cSList[0].address">
                            <Tooltip :disabled="!mainInfo.cSList[0].address" :content="mainInfo.cSList[0].address" class="tips" placement="bottom">
                                <i-input class="form-input" v-model="mainInfo.cSList[0].address" :maxlength="100" placeholder="实际通讯地址而非企业的工商注册地址" :disabled="!isEditable"></i-input>
                            </Tooltip>
                        </Form-item>
                    </div>
                </i-col>
                <i-col span="12" :style="{'background':2== selectedArea ?'#f6faf9' :''}">
                    <div class="part-title">乙方基本信息</div>
                    <div class="part-content" @mousedown ="selectArea(2)">
                        <Form-item label="企业名称" prop="cSList[1].name">
                            <Tooltip :disabled="!mainInfo.cSList[1].name" :content="mainInfo.cSList[1].name" class="tips" placement="bottom">
                                <i-input v-if="!isEditable" disabled class="form-input" v-model="mainInfo.cSList[1].name"></i-input>
                                <i-select v-if="isEditable"  class="form-input" @on-change="selectInfo" v-model="mainInfo.cSList[1].name">
                                    <i-option v-for="item in companyList" :value="item.name" :key="item.name" >{{ item.name }}</i-option>
                                </i-select>
                            </Tooltip>
                        </Form-item>
                        <Form-item label="开户银行">
                            <Tooltip :disabled="!mainInfo.cSList[1].bankName" :content="mainInfo.cSList[1].bankName" class="tips" placement="bottom">
                                <i-input class="form-input" v-model="mainInfo.cSList[1].bankName" placeholder="开户银行" disabled></i-input>
                            </Tooltip>
                        </Form-item>
                        <Form-item label="银行账号">
                            <Tooltip :disabled="!mainInfo.cSList[1].bankAccount" :content="mainInfo.cSList[1].bankAccount" class="tips" placement="bottom">
                                <i-input class="form-input" v-model="mainInfo.cSList[1].bankAccount" placeholder="银行账号" disabled></i-input>
                            </Tooltip>
                        </Form-item>
                        <Row>
                            <i-col span="13">
                                <Form-item label="联系人" prop="cSList[1].contactName">
                                    <Tooltip :disabled="!mainInfo.cSList[1].contactName" :content="mainInfo.cSList[1].contactName" class="tips" placement="bottom">
                                        <i-input class="form-input-name" v-model="mainInfo.cSList[1].contactName"  :maxlength="20" placeholder="联系人姓名" :disabled="!isEditable"></i-input>
                                    </Tooltip>
                                </Form-item>
                            </i-col>
                            <i-col span="10" offset="1">
                                <Form-item :label-width="1" prop="cSList[1].contactPhone">
                                    <Tooltip :disabled="!mainInfo.cSList[1].contactPhone" :content="mainInfo.cSList[1].contactPhone" class="tips" placement="bottom">
                                        <i-input class="form-input-tel" v-model="mainInfo.cSList[1].contactPhone" :maxlength="11" placeholder="联系电话" :disabled="!isEditable"></i-input>
                                    </Tooltip>
                                </Form-item>
                            </i-col>
                        </Row>
                        </Form-item>
                        <Form-item label="电子邮箱">
                            <Tooltip :disabled="!mainInfo.cSList[1].email" :content="mainInfo.cSList[1].email" class="tips" placement="bottom">
                                <i-input class="form-input" v-model="mainInfo.cSList[1].email" placeholder="电子邮箱" :disabled="!isEditable"></i-input>
                            </Tooltip>
                        </Form-item>
                        <Form-item label="联系地址">
                            <Tooltip :disabled="!mainInfo.cSList[1].address" :content="mainInfo.cSList[1].address" class="tips" placement="bottom">
                                <i-input class="form-input" v-model="mainInfo.cSList[1].address" placeholder="实际通讯地址而非企业的工商注册地址" disabled></i-input>
                            </Tooltip>
                        </Form-item>
                    </div>
                </i-col>
            </Row>
            <hr />
            <Row style="margin-top: 40px;">
                <div class="part-title">甲方所办理的业务内容</div>
                <div class="zl-content" style="outline: none">
                    <Row style="padding-left: 47px; font-size: 14px;">
                        <Row style="height: 32px;">
                            <div style="display: table-cell; width: 100px; padding-left: 20px; color: rgb(51,51,51); font-weight: 600;">委托事项</div>
                            <div style="display: table-cell; width: 200px; padding-left: 20px;"><Checkbox v-model="mainInfo.content.commitments[0].checked" :disabled="!isEditable">发明专利申请</Checkbox></div>
                            <div style="display: table-cell; width: 200px;"><Checkbox v-model="mainInfo.content.commitments[1].checked" :disabled="!isEditable">实用新型专利申请</Checkbox></div>
                            <div style="display: table-cell; width: 300px;"><Checkbox v-model="mainInfo.content.commitments[2].checked" :disabled="!isEditable">外观设计专利申请</Checkbox></div>
                        </Row>
                        <Row style="height: 32px;">
                            <div style="display: table-cell; width: 100px;"></div>
                            <div style="display: table-cell; width: 200px; padding-left: 21px;"><Checkbox v-model="mainInfo.content.commitments[3].checked" :disabled="!isEditable">专利续费</Checkbox></div>
                            <div style="display: table-cell; width: 200px;"><Checkbox v-model="mainInfo.content.commitments[4].checked" :disabled="!isEditable">专利转让</Checkbox></div>
                            <div style="display: table-cell; width: 300px;"><Checkbox v-model="mainInfo.content.commitments[5].checked" :disabled="!isEditable">专利变更</Checkbox></div>
                        </Row>
                        <Row style="height: 32px; margin-bottom: 5px;">
                            <div style="display: table-cell; width: 100px;"></div>
                            <div class="otherThings" style="display: table-cell; width: 600px; padding-left: 20px;">
                                <Form-item :label-width='1' prop="content.commitments[6].otherThingValue">
                                    <Checkbox v-model="mainInfo.content.commitments[6].checked" :disabled="!isEditable">其他事项</Checkbox>
                                    <i-input :maxlength="50" style="width:415px;" class="form-input-copyright-single-other" type="text" @click.native="editForm" v-model="mainInfo.content.commitments[6].otherThingValue" :disabled="!isEditable"></i-input>
                                </Form-item>
                            </div>
                        </Row>
                        <Row style="padding-top: 10px;" v-for="(thing, index) in mainInfo.content.thingsList" :key="index">
                            <div style="display: table-cell; width: 100px;"></div>
                            <div style="display: table-cell; width: 180px; padding-left: 20px;">
                                <Form-item :label-width='1' :prop="'content.thingsList.'+index+'.patentName'"
                                           :rules="{required: true, message: '请输入专利名称', trigger: 'blur'}">
                                    <i-input v-model="thing.patentName" class="form-input" placeholder="请输入专利名称" :maxlength="20" :disabled="!isEditable"></i-input>
                                </Form-item>
                            </div>
                            <div style="display: table-cell; width: 180px; padding-left: 20px;">
                                <Form-item :label-width='1' :prop="'content.thingsList.'+index+'.patentType'"
                                           :rules="{required: true, message: '请选择专利业务类型', trigger: 'change'}">
                                    <i-select v-model="thing.patentType" class="form-input" placeholder="请选择专利业务类型" :disabled="!isEditable">
                                        <i-option v-for="item in mainInfo.content.commitments" v-if="item.checked" :value="item.name" :key="item.name" >{{ item.name }}</i-option>
                                    </i-select>
                                </Form-item>
                            </div>
                            <div style="display: table-cell; width: 120px; padding-left: 10px;">
                                <i-button v-if="index!=0 && isEditable" small type="ghost" @click="handleRemove(thing)" icon="close-round"></i-button>
                                <i-button v-if="index==mainInfo.content.thingsList.length-1 && isEditable" small type="ghost" @click="handleAdd(index)" icon="plus-round"></i-button>
                            </div>
                        </Row>
                        <Row style="color: rgb(51,51,51); padding-top: 15px; margin-bottom: -20px;">
                            <div style="width:95px; height:30px; font-weight: 600; color: rgb(51,51,51);" class="form-item-height">
                                <label>服务费用明细</label>
                            </div>
                        </Row>
                        <Row v-for="(item, index) in mainInfo.content.commitments" :key="index" v-if="item.checked" style="padding-left: 20px; padding-top: 25px;">
                            <Row>
                                <div style="display: inline-flex; width: 100%; color: rgb(51, 51, 51);">
                                    <span>{{item.name + '费用：'}}</span>
                                    <span style="padding-left: 25px;">单价：￥</span>
                                    <Form-item class="serviceDetail" :label-width="1" :prop="'content.commitments.'+index+'.unitPrice'"
                                               :rules="[{required: true, message: '请输入单价', trigger: 'blur'},{ pattern:  /^-?\d+(\.\d+)?$/ ,message:'请输入正确的价格' },{ pattern: /^\d+(\.\d{1,2})?$/ ,message:'小数点最多两位' }]">
                                        <i-input style="width: 100px;" :maxlength="9" @on-change="setSubtotal(index)" class="form-input-unit-price" type="text" @click.native="editForm" v-model="item.unitPrice" :disabled="!isEditable"></i-input>
                                    </Form-item>
                                    <span>；</span>
                                    <span style="padding-left: 5px;">件数：￥</span>
                                    <Form-item class="serviceDetail" :label-width="1" :prop="'content.commitments.'+index+'.num'"
                                               :rules="[{required: true, message: '请输入件数', trigger: 'change'},{ pattern: /^\+?[1-9]\d*$/ ,message:'请输入大于0整数' }]">
                                        <i-input style="width: 100px;" :maxlength="3" @on-change="setSubtotal(index)" class="form-input-unit-price" type="text" @click.native="editForm" v-model="item.num" :disabled="!isEditable"></i-input>
                                    </Form-item>
                                    <span>；</span>
                                    <span style="padding-left: 5px;">总价：￥</span>
                                    <i-input style="width: 150px;" class="form-input-subtotal" type="text" @click.native="editForm" v-model="item.subtotal" :disabled="!isEditable" readonly></i-input>
                                    <span>；</span>
                                </div>
                            </Row>
                            <Row style="padding-top: 10px;">
                                <div style="display: inline-flex; width: 100%;">
                                    <div style="padding-left: 20px; font-size: 14px; color: rgb(51,51,51);">费用包含：</div>
                                    <Checkbox v-model="item.applicationFee" :disabled="!isEditable"><span style="color: rgb(51,51,51); font-size: 13px;">申请费</span></Checkbox>
                                    <Checkbox v-model="item.registrationFee" :disabled="!isEditable" v-if="index==0 || index==1 || index==2"><span style="color: rgb(51,51,51); font-size: 13px;">专利登记费、印刷费、印花税</span></Checkbox>
                                    <Checkbox v-model="item.examinationFee" :disabled="!isEditable" v-if="index==0"><span style="color: rgb(51,51,51); font-size: 13px;">实质审查费</span></Checkbox>
                                    <Checkbox v-model="item.agencyFee" :disabled="!isEditable"><span style="color: rgb(51,51,51); font-size: 13px;">代理费</span></Checkbox>
                                </div>
                            </Row>
                        </Row>
                    </Row>
                </div>
            </Row>
            <hr />
            <Row style="margin-top: 40px">
                <i-col span="24" :style="{'background':4== selectedArea ?'#f6faf9' :''}">
                    <div class="part-title">服务期限约定</div>
                    <div class="part-content" @mousedown ="selectArea(4)">
                        <Radio-Group v-model="mainInfo.periodType" :disabled="!isEditable">
                            <Row>
                                <Radio label="NONE">无明确服务周期</Radio>
                            </Row>
                            <br>
                        </Radio-Group>
                        <Row>
                            <div class="text-row">
                                <div class="text-item">本合同委托期限自本合同签字或盖章之日起至委托事项完成，以相关机关受理、批准、公示或下方相应证书、文件视为委托事项完成。</div>
                            </div>
                        </Row>
                    </div>
                </i-col>
            </Row>
            <hr />
            <Row id="zlPlan" style="margin-top: 40px">
                <i-col span="24" :style="{'background':5== selectedArea ?'#f6faf9' :''}">
                    <div class="part-title">甲方支付方案</div>
                    <div class="part-content" @mousedown ="selectArea(5)">
                        <Radio-Group v-model="mainInfo.paymentType">
                            <Row>
                                <Radio label="ONCE">一次性支付</Radio>
                            </Row>
                            <br>
                            <Row>
                                <div class="text-row">
                                    <div class="text-item">甲方应于本合同签署之日起三日内将本合同所列费用一次性支付和乙方。</div>
                                </div>
                            </Row>
                            <br>
                        </Radio-Group>
                        <div>
                            <span style="display: inline-block;font-weight: bold">支付方式 :</span>
                            <Checkbox-Group style="display: inline-block;margin-left: 20px" v-model="tempPayment" @on-change="changePayment">
                                <Checkbox label="WECHAT" :disabled="!isEditable">对公转账</Checkbox>
                                <Checkbox label="CHECK" :disabled="!isEditable">现金（支付宝、微信支付）</Checkbox>
                                <Checkbox label="POS" :disabled="!isEditable">POS 机刷卡</Checkbox>
                                <Checkbox label="ONLINE" :disabled="!isEditable">线上支付</Checkbox>
                            </Checkbox-Group>
                        </div>
                    </div>
                </i-col>
            </Row>
            <Row class="last-row" :style="{'background':6== selectedArea ?'#f6faf9' :''}">
                <div class="text-row" @mousedown ="selectArea(6)">
                    <div class="text-item">合约总额</div>
                    <div>
                        <span class="text-item-symbol">￥</span>
                    </div>
                    <Form-item style="margin-left: 30px;margin-right: 30px" :label-width="1" prop="price">
                        <i-input :maxlength="6" class="text-input form-input-price" style="width: 200px" type="text" v-model="getPrice" :readonly='true'></i-input>
                    </Form-item>
                    <div class="text-item">元</div>
                </div>
            </Row>
            <div style="clear:both"></div>
        </i-form>
        <br>
    </div>
</div>
<script>
    new Vue({
        el: "#zl",
        data: function() {
            var vm = this;
            var validatePrice = function(rule, value, callback) {
                if(Object.isNull(value) || String.isBlank(String(value))) {
                    callback(new Error("金额不能为空"));
                } else if (isNaN(value)) {
                    callback(new Error('请输入数字!'));
                } else if (value < 0) {
                    callback(new Error('请输入大于0的金额!'));
                } else if (!/^\d+(\.\d{1,2})?$/.test(value)) {
                    callback(new Error('请把小数点位数限制在2位以内!'));
                } else {
                    callback();
                }
            };
            var validateOtherThingValue = function(rule, value, callback) {
                if (vm.mainInfo.content.commitments[6].checked && vm.mainInfo.content.commitments[6].otherThingValue == "") {
                    return callback(new Error('请输入其他事项内容！'));
                } else {
                    callback();
                }
            };
            return {
                customerList:[],
                customerListNo:[],
                isEditable:true,
                imageFile:null,
                selectedArea:0,
                selectedCopyrightItem: null,
                companyList:[],
                op:"",
                isContractPerfect: false,
                mainInfo:{
                    contractDefId:"910039970264145924",
                    cSList:[{
                        type:'COMPANY',
                        subjectAlias :"A",
                        signedType :"SEAL"
                    },{
                        type:'',
                        subjectAlias :"B",
                        signedType :"SEAL"
                    }],
                    cRList:[],
                    paymentType:'ONCE',
                    periodType:'NONE',
                    content:{
                        commitments: [
                            {
                                name:"发明专利申请",
                                code: 'invention',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                examinationFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                            },
                            {
                                name:"实用新型专利申请",
                                code: 'new_type',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                            },
                            {
                                name:"外观设计专利申请",
                                code: 'appearance',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                            },
                            {
                                name:"专利续费",
                                code: 'renew',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                            },
                            {
                                name:"专利转让",
                                code: 'transfer',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                            },
                            {
                                name:"专利变更",
                                code: 'change',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                            },
                            {
                                name:"其他事项",
                                code: 'other',
                                checked: false,
                                applicationFee: true,
                                registrationFee: true,
                                agencyFee: true,
                                unitPrice: null,
                                num: null,
                                subtotal: 0,
                                otherThingValue: "",
                            },
                        ],
                        thingsList: [
                            {
                                patentName:"",
                                patentType:"",
                            }
                        ],
                    },
                    price: 0,
                    payment:""
                },
                tempPayment:[],
                leftCopyrightHeight:0,
                ruleForm:{
                    price: [
                        { required: true, message: '价格不能为空'},
                        { pattern:  /^-?\d+(\.\d+)?$/ ,message:'请输入正确的价格'},
                        { pattern:   /^[0-9]+([.]{1}[0-9]{1,2})?$/ ,message:'请输入合理数字'}
                    ],
                    "cSList[0].name": [
                        { required: true, message: '名称不能为空' }
                    ],
                    "cSList[0].idno": [
                        { required: true, message: '该项不能为空' },
                        { pattern:  /^[A-Za-z0-9]+$/ ,message:'只能是英文或者数字'}
                    ],
//                    "cSList[0].email": [
//                        { required: true, message: '邮箱不能为空' },
//                        { pattern:  /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/ ,message:'请输入正确的邮箱格式'}
//                    ],
                    "cSList[0].contactName": [
                        { required: true, message: '联系人不能为空' }
                    ],
                    "cSList[0].contactPhone": [
                        { required: true, message: '联系电话不能为空' }
                    ],
                    "cSList[0].address": [
                        { required: true, message: '地址不能为空' }
                    ],
                    "cSList[1].name": [
                        { required: true, message: '企业名不能为空' }
                    ],
                    "cSList[1].contactName": [
                        { required: true, message: '联系人不能为空' }
                    ],
                    "cSList[1].contactPhone": [
                        { required: true, message: '联系电话不能为空' }
                    ],
                    "content.commitments[6].otherThingValue": [
                        { validator: validateOtherThingValue ,trigger:'change'},
                    ],
                },
                formEditMode: false
            }
        },
        computed: {
            getPrice: function () {
                var price = 0;
                for(var i=0;i<this.mainInfo.content.commitments.length;i++) {
                    if (this.mainInfo.content.commitments[i].checked) {
                        price = price + this.mainInfo.content.commitments[i].subtotal;
                    }
                }
                this.$set(this.mainInfo,"price",price);
                return price;
            },
        },
        created: function () {
            this.$api.contractSaveApi = this.save;
        },
        methods: {
            init:function(param){
                if(param.isEditable == false){
                    this.isEditable = false;
                }
                if(param.defaultInfo){
                    this.mainInfo.cSList[0].type = param.defaultInfo.type;
                    this.mainInfo.cSList[0].name = param.defaultInfo.name;
                    this.mainInfo.cSList[0].idno = param.defaultInfo.idno;
                    this.mainInfo.cSList[0].contactName = param.defaultInfo.contactName;
                    this.mainInfo.cSList[0].contactPhone = param.defaultInfo.contactPhone;
                    this.mainInfo.cSList[0].email = param.defaultInfo.email;
                    this.mainInfo.cSList[0].address = param.defaultInfo.address;
                }
                if(param.contractId&&param.contractId>10000){
                    this.op = "";
                    this.loadData(param.contractId);
                }
                if(param.defId){
                    this.mainInfo.contractDefId = param.defId;
                }
                if(this.mainInfo.contractDefId){
                    this.loadCompanyList();
                }
                if(param.isContractPerfect){
                    this.isContractPerfect = param.isContractPerfect;
                }
            },
            clearSelectedService: function () {
                if(this.isEditable){
                    this.copyrightInfo.serviceItem.splice(0,this.copyrightInfo.serviceItem.length);
                }
            },
            cancelSelected : function () {
                if(this.formEditMode) {
                    this.formEditMode = false;
                }else{
                    if(this.selectedCopyrightItem != null){
                        this.$set(this,"selectedCopyrightItem",null);
                        this.$refs['copyrightFormRef'].resetFields();
                        this.$refs.copyrightFormRef.resetFields();
                    }
                }
            },
            //阻止冒泡
            stopBubbling: function () {
            },
            editForm: function() {
                this.formEditMode = true;
            },
            changeCsType:function(value){
                this.mainInfo.cSList[0].name='';
                this.mainInfo.cSList[0].idno='';
                this.mainInfo.cSList[0].email='';
                this.mainInfo.cSList[0].contactName='';
                this.mainInfo.cSList[0].contactPhone='';
                this.mainInfo.cSList[0].address='';
            },
            searchCustomerByNo:function(value){
                var vm = this;
                if(value.indexOf(' ')==-1){
                    this.request({
                        url: "/signCloud/contractBuilder/getCustomerList.do",
                        loading:false,
                        data:{
                            type:this.mainInfo.cSList[0].type,
                            name:'',
                            idno:value
                        }
                    }).then(function(data) {
                        vm.customerListNo = data;
                        vm.$refs.autoNO.toggleMenu(data&&data.length>0);
                    });
                }
            },
            selectCustomer:function(value){
                var vm = this;
                this.customerList.map(function(item){
                    if(item.name ==value){
                        vm.mainInfo.cSList[0].idno=item.IDNumber;
                        vm.mainInfo.cSList[0].email=item.email;
                        vm.mainInfo.cSList[0].address=item.address;
                        vm.mainInfo.cSList[0].contactName=item.linkmanName;
                        vm.mainInfo.cSList[0].contactPhone=item.linkmanPhone;
                        vm.$set(vm.mainInfo.cSList,0,vm.mainInfo.cSList[0]);
                }
            });
            },
            selectCustomerNo:function(value){
                var vm = this;
                this.customerListNo.map(function(item){
                    if(item.IDNumber ==value){
                        vm.mainInfo.cSList[0].name=item.name;
                        vm.mainInfo.cSList[0].email=item.email;
                        vm.mainInfo.cSList[0].address=item.address;
                        vm.mainInfo.cSList[0].contactName=item.linkmanName;
                        vm.mainInfo.cSList[0].contactPhone=item.linkmanPhone;
                        vm.$set(vm.mainInfo.cSList,0,vm.mainInfo.cSList[0]);
                }
            });
            },
            searchCustomerByName:function(value){
                var vm = this;
                if(value.indexOf(' ')==-1){
                    this.request({
                        url: "/signCloud/contractBuilder/getCustomerList.do",
                        loading:false,
                        data: {
                            type: this.mainInfo.cSList[0].type,
                            name: value,
                            idno: ''
                        }
                    }).then(function(data) {
                        vm.customerList = data;
                        vm.$refs.autoName.toggleMenu(data&&data.length>0);
                });
                }
            },
            selectArea:function (value) {
                this.selectedArea = value;
            },
            loadCompanyList:function(){
                var vm = this;
                this.request({
                    url: "/signCloud/contractBuilder/loadCompanyList.do?defId="+this.mainInfo.contractDefId
                }).then(function(data) {
                    vm.companyList = data;
                });
            },
            changePayment: function (paymentArray) {
                this.mainInfo.payment = "";
                if(paymentArray && paymentArray.length>0){
                    for(var i = 0;i<paymentArray.length;i++){
                        this.mainInfo.payment = this.mainInfo.payment + paymentArray[i] + ",";
                    }
                    if(this.mainInfo.payment != ""){
                        this.mainInfo.payment = this.mainInfo.payment.substring(0,this.mainInfo.payment.length-1);
                    }
                }
            },
            loadData:function(contractId){
                var vm = this;
                this.$set(this.mainInfo.cSList[0],"type",null);
                if(contractId&&contractId>10000){
                    this.request({
                        url: "/signCloud/contractBuilder/view.do?id="+contractId
                    }).then(function(data) {
                        vm.mainInfo = data;
                        var content = vm.mainInfo.content;
                        vm.mainInfo.content = JSON.parse(content);
                        if(vm.mainInfo.payment && vm.mainInfo.payment != ""){
                            vm.tempPayment = vm.mainInfo.payment.split(",");
                        }
                        vm.selectedCopyright = vm.mainInfo.content.selectedCopyright;
                        vm.$api.renderInsteadFromTemplate(data);
                    });
                }
            },
            selectInfo:function(name){
                var vm = this;
                this.companyList.map(function(item) {
                    if(item.name == name){
                        vm.$set(vm.mainInfo.cSList[1],'bankName',item.bankName);
                        vm.$set(vm.mainInfo.cSList[1],'bankAccount',item.bankAccount);
                        vm.$set(vm.mainInfo.cSList[1],'orgId',item.orgId);
                        vm.$set(vm.mainInfo.cSList[1],'idno',item.idno);
                        vm.$set(vm.mainInfo.cSList[1],'email',item.email);
                        vm.$set(vm.mainInfo.cSList[1],'address',item.address);
                        if(vm.op!='edit'){
                            vm.$set(vm.mainInfo.cSList[1],'contactName',item.contactName);
                            vm.$set(vm.mainInfo.cSList[1],'contactPhone',item.contactPhone);
                        }
                    }
                });
            },
            save:function(callBack){
                var vm = this;
                vm.$refs['formRef'].validate(function(valid){
                    if (valid) {
                        var cRList = [];
                        if(vm.mainInfo.cSList[0].type == "COMPANY"){
                            vm.mainInfo.cSList[0].signedType = "SEAL";
                        }else{
                            vm.mainInfo.cSList[0].signedType = "SIGNATURE";
                        }
                        var cSList = [vm.mainInfo.cSList[0],vm.mainInfo.cSList[1]];
                        //单笔
                        cRList.push({
                            price:vm.mainInfo.price,
                            title:'一次性支付',
                            idx:1
                        });
                        vm.mainInfo.content.selectedCopyright = vm.selectedCopyright;
                        var sendData =Object.assign({}, vm.mainInfo);
                        sendData.cRList = cRList;
                        sendData.cSList = cSList;
                        sendData.price = vm.mainInfo.price;
                        sendData.payment = vm.mainInfo.payment;
                        sendData.content = JSON.stringify(vm.mainInfo.content);
                        callBack(sendData);
                    } else {
                        callBack(false);
                    }
                });
            },
            handleAdd: function() {
                var thing = {
                    patentName:"",
                    patentType:"",
                }
                this.mainInfo.content.thingsList.push(thing);
            },
            handleRemove: function(item) {
                this.mainInfo.content.thingsList.splice(this.mainInfo.content.thingsList.indexOf(item), 1);
            },
            setSubtotal: function(index) {
                if (isNaN(this.mainInfo.content.commitments[index].unitPrice) || Object.isNull(this.mainInfo.content.commitments[index].unitPrice) || String.isBlank(String(this.mainInfo.content.commitments[index].unitPrice))
                    || isNaN(this.mainInfo.content.commitments[index].num) || Object.isNull(this.mainInfo.content.commitments[index].num) || String.isBlank(String(this.mainInfo.content.commitments[index].num)) ) {
                    this.$set(this.mainInfo.content.commitments[index], "subtotal", 0);
                } else {
                    var unitPrice = parseFloat(this.mainInfo.content.commitments[index].unitPrice);
                    this.$set(this.mainInfo.content.commitments[index], "subtotal",  Math.format(unitPrice * parseFloat(this.mainInfo.content.commitments[index].num),2));
                }
            },
        }

    })
</script>